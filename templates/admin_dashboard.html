<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Metro Analytics Dashboard</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="/static/style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
body {
  background: #f7f7f7;
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 0;
  display: flex;
}

/* Sidebar */
.sidebar {
  width: 240px;
  background-color: #ffffff;
  border-right: 1px solid #ddd;
  height: 100vh;
  position: fixed;
  top: 0;
  left: 0;
  padding: 30px 20px;
  box-shadow: 2px 0 5px rgba(0,0,0,0.05);
}

.sidebar h2 {
  font-size: 22px;
  margin-bottom: 25px;
  font-weight: bold;
  color: #333;
  text-align: center;
}

.nav {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.nav .btn {
  display: block;
  text-align: center;
  padding: 10px 12px;
  font-size: 15px;
  font-weight: 600;
  color: #333;
  background: #f8f9fa;
  border: 1px solid #ddd;
  border-radius: 8px;
  text-decoration: none;
  transition: all 0.25s ease;
}

.nav .btn:hover {
  background: #007bff;
  color: #fff;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

/* Summary Cards */
.container {
  margin-left: 270px;
  margin-top: 40px;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap: 25px;
  padding: 0 30px;
}

.card {
  background: #fff;
  border-radius: 14px;
  box-shadow: 0 3px 8px rgba(0,0,0,0.08);
  text-align: center;
  padding: 20px 10px;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.card:hover {
  transform: translateY(-4px);
  box-shadow: 0 6px 14px rgba(0,0,0,0.1);
}

.card h2 {
  font-size: 26px;
  color: #007bff;
  margin-bottom: 8px;
}

.card p {
  margin: 0;
  font-size: 15px;
  color: #555;
  font-weight: 500;
}

/* Charts Section */
.chart-wrapper {
  margin-left: 270px;
  margin-top: 50px;
  padding: 0 30px 60px;
}

.chart-wrapper h3 {
  font-size: 24px;
  font-weight: bold;
  color: #333;
  margin-bottom: 25px;
  text-align: center;
}

.chart-section {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
  gap: 30px;
}

.chart-box {
  background: #fff;
  border-radius: 16px;
  padding: 20px 15px;
  box-shadow: 0 3px 12px rgba(0,0,0,0.06);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.chart-box:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 15px rgba(0,0,0,0.08);
}

.chart-box h5 {
  font-size: 18px;
  font-weight: 600;
  color: #007bff;
  margin-bottom: 10px;
}

.chart-box canvas {
  width: 100%;
  height: 280px !important;
}

/* Responsive Fix */
@media (max-width: 768px) {
  .sidebar {
    position: relative;
    width: 100%;
    height: auto;
  }
  .container, .chart-wrapper {
    margin-left: 0;
    padding: 20px;
  }
}
  </style>
</head>

<body>
<div class="wrapper">
  <!-- Sidebar -->
  <div class="sidebar" id="sidebar">
    <h2>Admin Dashboard</h2>
    <div class="nav">
      <a href="/admin/login" class="btn">Back to Login</a>
      <a href="/admin/users" class="btn">Go to Users</a>
      <a href="/admin/stations" class="btn">Go to Stations</a>
      <a href="/admin/trains" class="btn">Manage Trains</a>
      <a href="/admin/generate-ticket" class="btn">Ticket</a>
      <a href="/admin/complaints" class="btn">View Complaints</a>
    </div>
  </div>
  <h3 style="margin-left: 700px;">Analytics Overview</h3>
  <!-- Summary Cards -->
  <div class="container">
    <div class="card"><h2>{{ total_tickets }}</h2><p>Total Tickets</p></div>
    <div class="card"><h2>{{ total_smartcards }}</h2><p>Smart Cards</p></div>
    <div class="card"><h2>{{ total_stations }}</h2><p>Stations</p></div>
    <div class="card"><h2>{{ total_complaints }}</h2><p>Complaints</p></div>
    <div class="card"><h2>{{ total_trains }}</h2><p>Trains</p></div>
    <div class="card"><h2>{{ total_lines }}</h2><p>Metro Lines</p></div>
  </div>

  <!-- Chart Section -->
  <!-- Chart Section -->
<div class="chart-wrapper">

  <!-- Month/Year Filter Form -->
  <div class="mb-4 d-flex justify-content-center gap-3">
    <form method="get" action="/admin/dashboard" class="d-flex gap-2 align-items-center flex-wrap">
      <div class="form-group">
        <label for="month" class="fw-bold">Month:</label>
        <select name="month" id="month" class="form-select">
          <option value="">--Select Month--</option>
          {% for m in range(1, 13) %}
            <option value="{{ m }}" {% if selected_month and selected_month|int == m %}selected{% endif %}>{{ m }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="form-group">
        <label for="year" class="fw-bold">Year:</label>
        <select name="year" id="year" class="form-select">
          <option value="">--Select Year--</option>
          {% for y in range(2022, 2031) %}
            <option value="{{ y }}" {% if selected_year and selected_year|int == y %}selected{% endif %}>{{ y }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="form-group mt-2">
        <button type="submit" class="btn btn-primary">Filter</button>
      </div>
    </form>
  </div>

  <div class="chart-section">
    <div class="chart-box">
      <h5>Tickets Sold</h5>
      <canvas id="ticketChart"></canvas>
    </div>

    <div class="chart-box">
      <h5>Complaints</h5>
      <canvas id="complaintChart"></canvas>
    </div>

    <div class="chart-box">
      <h5>Revenue by Metro Line</h5>
      <canvas id="revenueChart"></canvas>
    </div>

    <div class="chart-box">
      <h5>Tickets Sold by Station</h5>
      <canvas id="stationChart"></canvas>
    </div>
  </div>
</div>
<script>
  // Pass Flask data into JavaScript
  const trendLabels = {{ trend_labels | tojson }};
  const trendValues = {{ trend_values | tojson }};
  const complaintLabels = {{ complaint_labels | tojson }};
  const complaintValues = {{ complaint_values | tojson }};
  const revenueLabels = {{ revenue_by_line_labels | tojson }};
  const revenueValues = {{ revenue_by_line_values | tojson }};
  const stationLabels = {{ tickets_by_station_labels | tojson }};
  const stationValues = {{ tickets_by_station_values | tojson }};

  // --- Ticket Trend (Line Chart) ---
  new Chart(document.getElementById('ticketChart'), {
    type: 'line',
    data: {
      labels: trendLabels,
      datasets: [{
        label: 'Tickets Sold',
        data: trendValues,
        borderColor: '#007bff',
        backgroundColor: 'rgba(0, 123, 255, 0.2)',
        tension: 0.3,
        fill: true
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: true }
      },
      scales: {
        x: { title: { display: true, text: 'Date' } },
        y: { title: { display: true, text: 'Tickets Sold' }, beginAtZero: true }
      }
    }
  });

  // --- Complaint Trend (Bar Chart) ---
  new Chart(document.getElementById('complaintChart'), {
    type: 'bar',
    data: {
      labels: complaintLabels,
      datasets: [{
        label: 'Complaints',
        data: complaintValues,
        backgroundColor: 'rgba(255, 99, 132, 0.5)',
        borderColor: '#ff6384',
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: { beginAtZero: true }
      }
    }
  });

  // --- Revenue by Metro Line (Bar Chart) ---
  new Chart(document.getElementById('revenueChart'), {
    type: 'bar',
    data: {
      labels: revenueLabels,
      datasets: [{
        label: 'Revenue (â‚¹)',
        data: revenueValues,
        backgroundColor: 'rgba(75, 192, 192, 0.6)'
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: { beginAtZero: true }
      }
    }
  });

  // --- Tickets Sold by Station (Horizontal Bar Chart) ---
  new Chart(document.getElementById('stationChart'), {
    type: 'bar',
    data: {
      labels: stationLabels,
      datasets: [{
        label: 'Tickets Sold',
        data: stationValues,
        backgroundColor: 'rgba(153, 102, 255, 0.6)'
      }]
    },
    options: {
      indexAxis: 'y',
      responsive: true,
      scales: {
        x: { beginAtZero: true }
      }
    }
  });
</script>

</body>
</html>
