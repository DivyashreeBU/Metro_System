<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Metro Passenger Portal</title>
  <link rel="stylesheet" href="/static/style.css">
  <style> :root { --purple: #5b1fa6; --green: #2d7a47; --yellow: #e0b000; --bg-primary: linear-gradient(135deg, #f8f9ff 0%, #e8f4f8 50%, #f0f8f0 100%); --bg-card: linear-gradient(135deg, rgba(91, 31, 166, 0.08), rgba(45, 122, 71, 0.05)); --border-color: rgba(91, 31, 166, 0.2); --text-primary: #2d2d2d; } body { font-family: 'Segoe UI', sans-serif; background: var(--bg-primary); margin: 0; padding: 40px 0; color: var(--text-primary); } .container { width: 800px; margin: 40px auto; padding: 30px; background: var(--bg-card); border-radius: 15px; border: 1px solid var(--border-color); box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1); display: flex; flex-direction: column; gap: 20px; } h2 { text-align: center; color: var(--purple); font-size: 1.8rem; margin-bottom: 10px; } form { display: flex; flex-direction: column; gap: 20px; align-items: stretch; } .form-group { display: flex; align-items: center; gap: 20px; } .form-group label { flex: 1; font-weight: 500; } .form-group input, .form-group textarea { flex: 2; padding: 10px; border: 1px solid var(--border-color); border-radius: 6px; font-size: 1rem; } .btn { background: linear-gradient(45deg, var(--purple), var(--green)); color: #fff; padding: 12px 20px; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: transform 0.2s ease, opacity 0.3s ease; text-decoration: none; } .btn:hover { opacity: 0.9; transform: translateY(-2px); } /* ---- ALERT-STYLE MODAL ---- */ .dialog-box { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #fff; border-radius: 10px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3); width: 400px; padding: 25px; z-index: 2000; } .dialog-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.4); z-index: 1999; } .dialog-box h3 { margin-top: 0; color: var(--purple); text-align: center; } .dialog-box .close-btn { display: block; margin: 15px auto 0; background: var(--green); color: #fff; border: none; border-radius: 6px; padding: 8px 16px; cursor: pointer; font-weight: 600; } 
    /* Navigation Bar */
.nav-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 25px;
    border-radius: 12px;
    margin-bottom: 25px;
}

/* Nav Links */
.nav-link {
    text-decoration: none;
    font-weight: 600;
    font-size: 1rem;
    color: #5b1fa6;
    transition: 0.3s;
    padding: 8px 15px;
    border-radius: 8px;
}
.nav-link:hover {
    background-color: rgba(91,31,166,0.1);
    color: #2d7a47;
}

/* Reply Button */
.btn-reply {
    background: linear-gradient(135deg, #2d7a47 0%, #3ca055 100%);
    color: #fff;
    border: none;
    font-weight: 600;
    font-size: 1rem;
    border-radius: 8px;
    padding: 10px 20px;
    cursor: pointer;
    transition: 0.3s;
}
.btn-reply:hover {
    background: linear-gradient(135deg, #25663a 0%, #2f8348 100%);
    transform: scale(1.03);
}

  </style>
</head>
<body>{% include 'header.html' %}
  <div class="container">
    <div class="header">
      <h2>Welcome to Metro Passenger Portal</h2>
      <p>Submit your feedback or complaints to help us improve your travel experience.</p>
    </div>

    <div class="nav-bar" style="margin-top: -50px;">
  <a href="/services" class="nav-link" style="margin-right: 450px;">Back</a>
  <button onclick="loadReplyForm()" class="btn btn-reply" style="margin-right: 20px;">Check Replies</button>
</div>

    <form method="post" action="/submit-complaint" class="form-box" style="margin-top: -80px;">
      <div>
        <label for="name">Name:</label>
        <input name="name" id="name" placeholder="Your full name" required>
      </div>

      <div>
        <label for="email">Email:</label>
        <input name="email" id="email" type="email" placeholder="Your email address" required>
      </div>

      <div>
        <label for="subject">Subject:</label>
        <input name="subject" id="subject" placeholder="Complaint subject" required>
      </div>

      <div>
        <label for="message">Message:</label>
        <textarea name="message" id="message" rows="5" placeholder="Describe your issue..." required></textarea>
      </div>

      <button type="submit" class="btn">Submit Complaint</button>
    </form>

    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <ul class="flash-messages">
          {% for message in messages %}
            <li>{{ message }}</li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}

    <div id="reply-form-container"></div>
  </div>

  <script>
    function loadReplyForm() {
  const container = document.getElementById('reply-form-container');
  container.innerHTML = `
    <div class="reply-container">
      <h3 style="text-align:center;">Check Admin Replies</h3>
      <p>Enter your email to view replies for your submitted complaints.</p>
      <form id="check-reply-form" class="form-box">
        <label for="lookup-email">Email:</label>
        <input name="email" id="lookup-email" type="email" placeholder="Enter your email" required>
        <div style="display:flex; gap:10px; margin-top:8px;">
          <button type="submit" class="btn">üîç View Replies</button>
        </div>
      </form>
      <div id="reply-results"></div>
    </div>
  `;

  document.getElementById('check-reply-form').addEventListener('submit', fetchReplies);
}

async function fetchReplies(event) {
    event.preventDefault();
    const resultsContainer = document.getElementById('reply-results');
    resultsContainer.innerHTML = ''; // clear old

    const email = document.getElementById('lookup-email').value.trim();
    if (!email) {
        resultsContainer.innerHTML = `<p class="no-reply">‚ö†Ô∏è Please enter an email.</p>`;
        return;
    }

    resultsContainer.innerHTML = `<p>‚è≥ Checking replies for <strong>${email}</strong>...</p>`;

    try {
        const resp = await fetch('/check-reply', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json' // IMPORTANT: tell Flask we send JSON
            },
            body: JSON.stringify({ email }) // send email as JSON
        });

        if (!resp.ok) {
            resultsContainer.innerHTML = `<p class="no-reply">‚ö†Ô∏è Server error ${resp.status}</p>`;
            return;
        }

        const data = await resp.json();

        if (data.replies && data.replies.length > 0) {
            resultsContainer.innerHTML = data.replies.map(r => `
                <div class="reply-box">
                    <div><strong>Subject:</strong> ${r.subject}</div>
                    <div><strong>Admin Reply:</strong><br>${r.reply || 'Pending'}</div>
                </div>
            `).join('');
        } else {
            resultsContainer.innerHTML = `<p class="no-reply">‚ùå No replies found for <strong>${email}</strong>.</p>`;
        }

    } catch (error) {
        console.error(error);
        resultsContainer.innerHTML = `<p class="no-reply">‚ö†Ô∏è Error fetching replies: ${error.message}</p>`;
    }
}


  </script>
</body>
</html>
